---
import { Fragment } from 'astro/jsx-runtime';
import Layout from '../../layouts/Layout.astro';
import NewsList from './NewsList.astro';
import InnerHero from '../sections/InnerHero.astro';
import Button from '../ui/Button.astro';
import { ChevronLeft, ChevronRight } from 'lucide-astro';

import newsHeroImage from '@assets/images/blog-hero-2.jpg';

interface Props {
    articles: any[];
    currentPage: number;
    totalPages: number;
    baseUrl: string;  // e.g., '/berita' or '/sektor/perbankan'
    title: string;
    subtitle: string;
    currentSector?: string;
    seoTitle?: string;
    seoDescription?: string;
}

const { 
    articles: paginatedArticles, 
    currentPage, 
    totalPages, 
    baseUrl,
    title,
    subtitle,
    currentSector,
    seoTitle = "Berita Pasar Saham Indonesia",
    seoDescription = "Berita terkini dan analisis mendalam pasar saham Indonesia - sektor perbankan, IPO, barang konsumen, dan infrastruktur."
} = Astro.props;

// Generate pagination URLs
const nextPage = currentPage < totalPages ? `${baseUrl}/${currentPage + 1}` : null;
const prevPage = currentPage > 1 
    ? currentPage - 1 === 1 
        ? baseUrl
        : `${baseUrl}/${currentPage - 1}`
    : null;

const heroContent = {
    title: title,
    description: subtitle,
    backgroundImage: newsHeroImage,
    overlayOpacity: 0.2
}
---
<Layout title={seoTitle} description={seoDescription}>
    <main>
        <InnerHero content={heroContent}/>
        <NewsList articles={paginatedArticles} currentSector={currentSector} />

        {totalPages > 1 && (
            <nav class="pagination-nav" aria-label="News pagination" data-aos="fade-in">
                <div class="container mx-auto px-4 py-12">
                    <div class="flex items-center justify-center gap-6">
                        {prevPage && (
                            <Button href={prevPage} variant="primary" class="flex items-center gap-2">
                                <ChevronLeft size={20} />
                                Sebelumnya
                            </Button>
                        )}
                        
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600 mr-2">Halaman:</span>
                            {Array.from({ length: totalPages }, (_, i) => i + 1).map((pageNum) => {
                                // Show first, last, current, and adjacent pages
                                const showPage = pageNum === 1 || 
                                                pageNum === totalPages || 
                                                Math.abs(pageNum - currentPage) <= 1;
                                
                                if (!showPage && pageNum === currentPage - 2) {
                                    return <span key={`ellipsis-${pageNum}`} class="px-2">...</span>;
                                }
                                
                                if (!showPage) return <Fragment key={`empty-${pageNum}`}></Fragment>;
                                
                                return (
                                    <a
                                        key={`page-${pageNum}`}
                                        href={pageNum === 1 ? baseUrl : `${baseUrl}/${pageNum}`}
                                        class={`w-10 h-10 flex items-center justify-center rounded-full transition-colors ${
                                            currentPage === pageNum
                                                ? 'bg-primary text-white font-bold'
                                                : 'bg-gray-100 hover:bg-gray-200 text-gray-700'
                                        }`}
                                        aria-current={currentPage === pageNum ? 'page' : undefined}
                                    >
                                        {pageNum}
                                    </a>
                                );
                            })}
                        </div>

                        {nextPage && (
                            <Button href={nextPage} variant="primary" class="flex items-center gap-2">
                                Selanjutnya
                                <ChevronRight size={20} />
                            </Button>
                        )}
                    </div>
                    
                    <div class="text-center mt-4 text-sm text-gray-600">
                        Halaman {currentPage} dari {totalPages}
                    </div>
                </div>
            </nav>
        )}
    </main>
</Layout>