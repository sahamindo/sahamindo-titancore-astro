---
import { getCollection } from 'astro:content';
import { marketSectors } from '@data/categories';
import { newsSetting } from '@data/config';
import PaginatedNewsLayout from '@components/news/PaginatedNewsLayout.astro';

export async function getStaticPaths() {
    const allArticles = await getCollection('news', ({ data }) => {
        return import.meta.env.DEV || data.publish !== false;
    });

    const paths = [];

    for (const sector of marketSectors) {
        const sectorArticles = allArticles
            .filter(article => article.data.category === sector.id)
            .sort((a, b) => b.data.publishDate.getTime() - a.data.publishDate.getTime());

        const articlesPerPage = newsSetting.articlesPerPage;
        const totalPages = Math.ceil(sectorArticles.length / articlesPerPage);

        for (let page = 1; page <= totalPages; page++) {
            const startIndex = (page - 1) * articlesPerPage;
            const endIndex = startIndex + articlesPerPage;
            const pageArticles = sectorArticles.slice(startIndex, endIndex);

            paths.push({
                params: { 
                    sector: sector.slug,
                    page: page.toString()
                },
                props: {
                    sector,
                    articles: pageArticles,
                    currentPage: page,
                    totalPages,
                    totalArticles: sectorArticles.length
                }
            });
        }
    }

    return paths;
}

const { sector, articles, currentPage, totalPages } = Astro.props;

const pageTitle = `Berita ${sector.name} - Halaman ${currentPage}`;
const pageDescription = `Berita sektor ${sector.name.toLowerCase()} halaman ${currentPage}. ${sector.description}`;
---

<PaginatedNewsLayout
    articles={articles}
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl={`/sektor/${sector.slug}`}
    title={pageTitle}
    subtitle={sector.description}
    currentSector={sector.id}
    seoTitle={`Berita ${sector.name} Halaman ${currentPage} - Sahamindo`}
    seoDescription={pageDescription}
/>