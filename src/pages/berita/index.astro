---
import { getCollection } from 'astro:content';
import { newsSetting } from '@data/config';
import PaginatedNewsLayout from '@components/news/PaginatedNewsLayout.astro';

const allArticles = await getCollection('news', ({ data }) => {
    return import.meta.env.DEV || data.publish !== false;
});

// Sort articles by date (newest first)
const sortedArticles = allArticles.sort((a, b) => 
    b.data.publishDate.getTime() - a.data.publishDate.getTime()
);

// Pagination logic
const articlesPerPage = newsSetting.articlesPerPage;
const totalArticles = sortedArticles.length;
const totalPages = Math.ceil(totalArticles / articlesPerPage);
const currentPage = 1;

// Get articles for current page
const paginatedArticles = sortedArticles.slice(0, articlesPerPage);

const pageTitle = 'Semua Berita Pasar Saham Indonesia';
const pageDescription = 'Berita dan analisis terkini pasar saham Indonesia dari semua sektor - perbankan, IPO, barang konsumen, dan infrastruktur.';
---

<PaginatedNewsLayout
    articles={paginatedArticles}
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/berita"
    title={pageTitle}
    subtitle="Kumpulan berita dan analisis pasar modal Indonesia"
    seoTitle="Berita Saham Indonesia - Sahamindo"
    seoDescription={pageDescription}
/>