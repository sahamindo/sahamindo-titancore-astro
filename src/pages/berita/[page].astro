---
import { getCollection } from 'astro:content';
import { newsSetting } from '@data/config';
import PaginatedNewsLayout from '@components/news/PaginatedNewsLayout.astro';

export async function getStaticPaths() {
    const allArticles = await getCollection('news', ({ data }) => {
        return import.meta.env.DEV || data.publish !== false;
    });

    const sortedArticles = allArticles.sort((a, b) => 
        b.data.publishDate.getTime() - a.data.publishDate.getTime()
    );

    const articlesPerPage = newsSetting.articlesPerPage;
    const totalPages = Math.ceil(sortedArticles.length / articlesPerPage);

    return Array.from({ length: totalPages }, (_, i) => ({
        params: { page: (i + 1).toString() },
        props: {
            articles: sortedArticles.slice(i * articlesPerPage, (i + 1) * articlesPerPage),
            currentPage: i + 1,
            totalPages,
            totalArticles: sortedArticles.length
        }
    }));
}

const { articles, currentPage, totalPages } = Astro.props;

const pageTitle = `Berita Saham Indonesia - Halaman ${currentPage}`;
const pageDescription = `Berita dan analisis pasar saham Indonesia halaman ${currentPage}. Update terkini dari Bursa Efek Indonesia.`;
---

<PaginatedNewsLayout
    articles={articles}
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/berita"
    title={pageTitle}
    subtitle="Kumpulan berita dan analisis pasar modal Indonesia"
    seoTitle={`Berita Saham Indonesia Halaman ${currentPage} - Sahamindo`}
    seoDescription={pageDescription}
/>